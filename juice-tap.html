<!DOCTYPE html>
<html lang="en">
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-P1VFNJ21V0"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-P1VFNJ21V0');</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9556113318001178" crossorigin="anonymous"></script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Juice Tap â€“ GameCave</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Nunito:wght@400;700;800&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;}
html,body{width:100%;height:100%;overflow:hidden;background:#0a0005;}
body{display:flex;flex-direction:column;font-family:'Nunito',sans-serif;}
.topbar{flex-shrink:0;background:rgba(10,0,5,0.96);border-bottom:2px solid #3a1828;padding:0.6rem 1.2rem;display:flex;align-items:center;justify-content:space-between;z-index:10;}
.logo{font-family:'Cinzel',serif;font-size:1.1rem;font-weight:900;color:#e8a020;text-decoration:none;letter-spacing:0.08em;}
.logo span{color:#ffcc55;}
.back{color:#9a8870;text-decoration:none;font-size:0.75rem;font-weight:700;text-transform:uppercase;letter-spacing:0.1em;padding:0.35rem 0.9rem;border:1px solid #3a1828;border-radius:3px;transition:all .15s;}
.back:hover{color:#ffcc55;border-color:#e8a020;}
canvas{display:block;flex:1;cursor:crosshair;touch-action:none;}
</style>
</head>
<body>
<div class="topbar">
  <a class="logo" href="index.html">ğŸª¨ GAME<span>CAVE</span></a>
  <a class="back" href="index.html">â† Back</a>
</div>
<canvas id="c"></canvas>
<script>
'use strict';
const C = document.getElementById('c');
const X = C.getContext('2d');
let W, H;

function resize() {
  const rect = C.getBoundingClientRect();
  W = C.width  = window.innerWidth;
  H = C.height = window.innerHeight - rect.top;
}
resize();
window.addEventListener('resize', () => { resize(); if (!running) drawMenu(); });

/* â”€â”€â”€ FRUIT DATA â”€â”€â”€ */
const FRUIT = [
  { e:'ğŸ‹', col:'#f1c40f', pts:10, r:26, spd:1.0 },
  { e:'ğŸ“', col:'#e74c3c', pts:15, r:24, spd:1.1 },
  { e:'ğŸŠ', col:'#e67e22', pts:12, r:26, spd:1.0 },
  { e:'ğŸ‡', col:'#9b59b6', pts:20, r:28, spd:0.9 },
  { e:'ğŸ‰', col:'#27ae60', pts:18, r:30, spd:0.85 },
  { e:'ğŸ«', col:'#2980b9', pts:25, r:22, spd:1.2 },
  { e:'ğŸ¥­', col:'#f39c12', pts:30, r:28, spd:0.9 },
  { e:'ğŸ’', col:'#c0392b', pts:40, r:20, spd:1.3 },
];

/* â”€â”€â”€ STATE â”€â”€â”€ */
let drops=[], fx=[], score=0, hi=0, lives=3, combo=0, comboDecay=0;
let running=false, phase='menu', raf=0, tick=0, spawnCd=0, level=1;
let flashCol='', flashA=0, shakeX=0, shakeY=0, shakeDec=0;
let slowTicks=0;

function reset() {
  drops=[]; fx=[]; score=0; lives=3; combo=0; comboDecay=0;
  tick=0; spawnCd=0; level=1; flashA=0; shakeX=shakeY=0; slowTicks=0;
}

/* â”€â”€â”€ HELPERS â”€â”€â”€ */
function shake(n) { shakeX=(Math.random()-.5)*n; shakeY=(Math.random()-.5)*n; shakeDec=n*.12; }
function flash(col) { flashCol=col; flashA=0.35; }
function rnd(a,b) { return a+Math.random()*(b-a); }

function addFx(x,y,txt,col,big) {
  fx.push({x,y,vy:-2.5-Math.random(),txt,col,a:1,big:big||false});
}

function burst(x,y,col,n) {
  for(let i=0;i<n;i++) {
    const a=Math.random()*Math.PI*2, s=rnd(2,7);
    fx.push({x,y,vx:Math.cos(a)*s,vy:Math.sin(a)*s,r:rnd(2,5),col,a:1,type:'dot'});
  }
}

/* â”€â”€â”€ SPAWN â”€â”€â”€ */
function spawn() {
  const maxF = Math.min(2 + Math.floor(level/1.8), FRUIT.length);
  const f = FRUIT[Math.floor(Math.random()*maxF)];
  const margin = f.r + 10;
  drops.push({
    x: rnd(margin, W-margin),
    y: -f.r - 20,
    vy: (rnd(1.4,2.4) + level*0.18) * f.spd,
    r: f.r,
    e: f.e,
    col: f.col,
    pts: f.pts,
    wob: Math.random()*Math.PI*2,  // wobble phase
    alive: true,
    bomb: false,
  });
}

function spawnBomb() {
  drops.push({
    x: rnd(40, W-40),
    y: -40,
    vy: rnd(1.2,2.0) + level*0.1,
    r: 26,
    e: 'ğŸ’£',
    col: '#555',
    pts: 0,
    wob: 0,
    alive: true,
    bomb: true,
  });
}

/* â”€â”€â”€ UPDATE â”€â”€â”€ */
function update() {
  tick++;
  level = 1 + Math.floor(score / 30);

  // spawn
  spawnCd--;
  if(spawnCd <= 0) {
    const rate = Math.max(14, 52 - level*3);
    spawnCd = rate + Math.floor(Math.random()*10);
    if(level >= 3 && Math.random() < 0.09) spawnBomb(); else spawn();
  }

  const sm = slowTicks > 0 ? 0.28 : 1;
  if(slowTicks > 0) slowTicks--;

  // move drops
  for(const d of drops) {
    if(!d.alive) continue;
    d.y += d.vy * sm;
    d.wob += 0.06;
    if(d.y > H + d.r + 20) {
      d.alive = false;
      if(!d.bomb) {
        lives--;
        combo = 0; comboDecay = 0;
        burst(d.x, H-10, '#e74c3c', 12);
        addFx(d.x, H-70, 'MISS!', '#e74c3c', true);
        flash('#e74c3c');
        shake(10);
        if(lives <= 0) { endGame(); return; }
      }
    }
  }
  drops = drops.filter(d => d.alive);

  // fx
  for(const f of fx) {
    if(f.type==='dot') { f.x+=f.vx; f.y+=f.vy; f.vx*=0.88; f.vy+=0.12; f.a-=0.03; }
    else               { f.y+=f.vy; f.a-=0.022; }
  }
  fx = fx.filter(f => f.a > 0);

  // combo decay
  if(combo > 0) {
    comboDecay--;
    if(comboDecay <= 0) combo = 0;
  }

  // screen shake decay
  if(Math.abs(shakeX) > 0.3) { shakeX *= 0.8; shakeY *= 0.8; }
  else { shakeX = 0; shakeY = 0; }
  if(flashA > 0) flashA -= 0.025;
}

/* â”€â”€â”€ DRAW â”€â”€â”€ */
function draw() {
  X.save();
  if(shakeX) X.translate(shakeX, shakeY);

  // Background â€” juicy gradient
  const bg = X.createLinearGradient(0,0,0,H);
  bg.addColorStop(0, '#12000a');
  bg.addColorStop(0.5, '#1a0510');
  bg.addColorStop(1, '#0a0005');
  X.fillStyle = bg; X.fillRect(0,0,W,H);

  // Subtle radial spotlight from above
  const spot = X.createRadialGradient(W/2, -60, 0, W/2, -60, H*0.9);
  spot.addColorStop(0, 'rgba(255,150,60,0.07)');
  spot.addColorStop(1, 'transparent');
  X.fillStyle = spot; X.fillRect(0,0,W,H);

  // Ground glow
  const gnd = X.createLinearGradient(0, H-60, 0, H);
  gnd.addColorStop(0, 'transparent');
  gnd.addColorStop(1, 'rgba(200,30,80,0.15)');
  X.fillStyle = gnd; X.fillRect(0, H-60, W, 60);

  // Ground line
  X.strokeStyle = 'rgba(220,60,100,0.3)'; X.lineWidth = 2;
  X.beginPath(); X.moveTo(0, H-3); X.lineTo(W, H-3); X.stroke();

  // DROPS
  for(const d of drops) {
    if(!d.alive) continue;
    const wobX = Math.sin(d.wob) * 3.5;

    X.save(); X.translate(d.x + wobX, d.y);

    // Shadow under fruit
    X.globalAlpha = 0.22;
    X.fillStyle = '#000';
    X.beginPath(); X.ellipse(0, d.r+6, d.r*0.7, d.r*0.2, 0, 0, Math.PI*2); X.fill();
    X.globalAlpha = 1;

    // Outer glow ring
    const glo = X.createRadialGradient(0,0, d.r*0.4, 0,0, d.r*2.2);
    glo.addColorStop(0, d.col+'55'); glo.addColorStop(1, 'transparent');
    X.fillStyle = glo;
    X.beginPath(); X.arc(0,0, d.r*2.2, 0, Math.PI*2); X.fill();

    // Fruit emoji
    X.font = `${d.r*1.8}px serif`;
    X.textAlign = 'center'; X.textBaseline = 'middle';
    X.fillText(d.e, 0, 0);

    // Bomb fuse animation
    if(d.bomb) {
      X.strokeStyle = '#f39c12'; X.lineWidth = 2.5;
      X.beginPath();
      X.moveTo(8, -d.r+4);
      X.quadraticCurveTo(18, -d.r-12, 15, -d.r-20);
      X.stroke();
      if(tick%3===0) burst(d.x+wobX+15, d.y-d.r-20, '#f39c12', 1);
    }

    X.restore();
  }

  // FX layer
  for(const f of fx) {
    X.globalAlpha = Math.max(0, f.a);
    if(f.type==='dot') {
      X.fillStyle = f.col;
      X.beginPath(); X.arc(f.x, f.y, f.r, 0, Math.PI*2); X.fill();
    } else {
      const sz = f.big ? 22 : 18;
      X.font = `bold ${sz}px Cinzel,serif`;
      X.textAlign = 'center'; X.textBaseline = 'middle';
      X.fillStyle = f.col; X.fillText(f.txt, f.x, f.y);
    }
  }
  X.globalAlpha = 1;

  // Screen flash
  if(flashA > 0) {
    X.globalAlpha = flashA;
    X.fillStyle = flashCol; X.fillRect(0,0,W,H);
    X.globalAlpha = 1;
  }

  // Slow-mo tint
  if(slowTicks > 0) {
    X.globalAlpha = 0.07;
    X.fillStyle = '#3db8a0'; X.fillRect(0,0,W,H);
    X.globalAlpha = 1;
    X.font = 'bold 13px Cinzel,serif';
    X.textAlign = 'center'; X.fillStyle = '#3db8a0';
    X.fillText('â± SLOW MO', W/2, 90);
  }

  // â”€â”€ HUD â”€â”€
  const HH = 68;
  // HUD bg
  X.fillStyle = 'rgba(10,0,5,0.9)'; X.fillRect(0, 0, W, HH);
  X.strokeStyle = 'rgba(80,20,40,0.9)'; X.lineWidth = 1.5;
  X.beginPath(); X.moveTo(0,HH); X.lineTo(W,HH); X.stroke();

  const p = 16;
  X.textBaseline = 'top';

  // SCORE
  X.textAlign = 'left';
  X.font = 'bold 10px Nunito,sans-serif'; X.fillStyle = '#9a8870'; X.fillText('SCORE', p, p);
  X.font = 'bold 26px Cinzel,serif'; X.fillStyle = '#ffcc55'; X.fillText(score, p, p+13);

  // BEST
  X.textAlign = 'center';
  X.font = 'bold 10px Nunito,sans-serif'; X.fillStyle = '#9a8870'; X.fillText('BEST', W/2, p);
  X.font = 'bold 20px Cinzel,serif'; X.fillStyle = '#e8a020'; X.fillText(hi, W/2, p+13);

  // LEVEL
  X.textAlign = 'center';
  X.font = 'bold 10px Nunito,sans-serif'; X.fillStyle = '#9a8870'; X.fillText('LEVEL', W*0.72, p);
  X.font = 'bold 20px Cinzel,serif'; X.fillStyle = '#3db8a0'; X.fillText(level, W*0.72, p+13);

  // LIVES
  X.textAlign = 'right';
  X.font = 'bold 10px Nunito,sans-serif'; X.fillStyle = '#9a8870'; X.fillText('LIVES', W-p, p);
  X.font = '20px serif'; X.fillText('â¤ï¸'.repeat(Math.max(0,lives)), W-p, p+12);

  // COMBO bar
  if(combo >= 2) {
    const colors = ['#e8a020','#f39c12','#e74c3c','#9b59b6','#3db8a0','#f1c40f'];
    const cc = colors[Math.min(combo-2, colors.length-1)];
    const bw = Math.min(220, W*0.5), bh = 8;
    const bx = (W-bw)/2, by = HH + 8;
    X.fillStyle = 'rgba(0,0,0,0.5)'; X.beginPath(); X.roundRect(bx,by,bw,bh,4); X.fill();
    X.fillStyle = cc; X.beginPath(); X.roundRect(bx,by,bw*(comboDecay/80),bh,4); X.fill();
    X.font = 'bold 13px Cinzel,serif'; X.textAlign = 'center';
    X.fillStyle = cc; X.fillText(`${combo}Ã— COMBO ğŸ”¥`, W/2, by+bh+14);
  }

  X.restore();
}

/* â”€â”€â”€ TAP â”€â”€â”€ */
function tap(ex, ey) {
  if(phase !== 'play') { startGame(); return; }

  for(let i = drops.length-1; i >= 0; i--) {
    const d = drops[i];
    if(!d.alive) continue;
    const wobX = Math.sin(d.wob)*3.5;
    const dist = Math.hypot(ex-(d.x+wobX), ey-d.y);
    if(dist < d.r * 1.5) {
      d.alive = false;
      if(d.bomb) {
        // SLOW MO
        slowTicks = 160;
        burst(d.x+wobX, d.y, '#f39c12', 20);
        burst(d.x+wobX, d.y, '#fff', 8);
        addFx(d.x+wobX, d.y-50, 'SLOW MO!', '#f39c12', true);
      } else {
        combo++;
        comboDecay = 80;
        const mult = combo >= 6 ? 4 : combo >= 4 ? 3 : combo >= 2 ? 2 : 1;
        const earned = d.pts * mult;
        score += earned;
        if(score > hi) hi = score;
        burst(d.x+wobX, d.y, d.col, 14);
        const tag = (mult > 1 ? `Ã—${mult} ` : '') + '+' + earned;
        addFx(d.x+wobX, d.y-40, tag, d.col, mult > 1);
        // small flash
        flashCol = d.col; flashA = 0.08;
      }
      break;
    }
  }
}

/* â”€â”€â”€ SCREENS â”€â”€â”€ */
function drawMenu() {
  const bg = X.createLinearGradient(0,0,0,H);
  bg.addColorStop(0,'#12000a'); bg.addColorStop(1,'#0a0005');
  X.fillStyle=bg; X.fillRect(0,0,W,H);

  X.textAlign='center'; X.textBaseline='middle';

  // Big fruit row
  const fruits='ğŸ‹ğŸ“ğŸŠğŸ‡ğŸ‰ğŸ«';
  X.font=`${Math.min(54,W/8)}px serif`;
  X.fillText(fruits, W/2, H*0.28);

  X.font=`bold ${Math.min(46,W*0.1)}px Cinzel,serif`;
  X.fillStyle='#e8a020';
  // glow effect
  X.shadowColor='#ff6a00'; X.shadowBlur=30;
  X.fillText('JUICE TAP', W/2, H*0.44);
  X.shadowBlur=0;

  X.font=`${Math.min(15,W*0.038)}px Nunito,sans-serif`; X.fillStyle='#9a8870';
  X.fillText('Tap every fruit before it hits the ground', W/2, H*0.54);
  X.fillText('ğŸ’£ Tap bombs for SLOW MO power!', W/2, H*0.60);
  X.fillText('Build combos to multiply your points', W/2, H*0.66);

  drawButton(W/2, H*0.77, 'ğŸ¹  START JUICING', '#e8a020', '#ff6a00');
}

function drawGameOver() {
  // darken
  X.fillStyle='rgba(0,0,0,0.82)'; X.fillRect(0,0,W,H);
  X.textAlign='center'; X.textBaseline='middle';

  X.font=`bold ${Math.min(44,W*0.1)}px Cinzel,serif`;
  X.shadowColor='#ff6a00'; X.shadowBlur=25; X.fillStyle='#e8a020';
  X.fillText('ğŸ¥¤ JUICED OUT!', W/2, H*0.3);
  X.shadowBlur=0;

  X.font=`bold ${Math.min(26,W*0.065)}px Nunito,sans-serif`; X.fillStyle='#f0e6d0';
  X.fillText('Score  ' + score, W/2, H*0.42);
  X.fillText('Best   ' + hi,    W/2, H*0.50);

  X.font=`${Math.min(15,W*0.038)}px Nunito,sans-serif`; X.fillStyle='#9a8870';
  const msg = score>=500 ? 'Master Juicer! ğŸ†' : score>=200 ? 'Nice run! ğŸŠ' : 'Keep at it! ğŸ‹';
  X.fillText(msg, W/2, H*0.59);

  drawButton(W/2, H*0.72, 'ğŸ¹  PLAY AGAIN', '#e8a020', '#ff6a00');
}

function drawButton(cx, cy, label, c1, c2) {
  const bw = Math.min(260, W*0.65), bh = 54;
  const bx = cx-bw/2, by = cy-bh/2;
  const g = X.createLinearGradient(bx,cy,bx+bw,cy);
  g.addColorStop(0,c1); g.addColorStop(1,c2);
  X.fillStyle=g; X.beginPath(); X.roundRect(bx,by,bw,bh,bh/2); X.fill();
  X.font='bold 17px Cinzel,serif'; X.fillStyle='#1a0800';
  X.textAlign='center'; X.textBaseline='middle'; X.fillText(label,cx,cy);
}

/* â”€â”€â”€ GAME FLOW â”€â”€â”€ */
function gameLoop() {
  update();
  draw();
  if(running) raf = requestAnimationFrame(gameLoop);
}

function startGame() {
  cancelAnimationFrame(raf);
  reset(); phase='play'; running=true;
  gtag('event','game_start',{game:'Juice Tap'});
  raf = requestAnimationFrame(gameLoop);
}

function endGame() {
  running=false; phase='over';
  drops=[]; fx=[];
  gtag('event','game_over',{game:'Juice Tap',score,level});
  drawGameOver();
}

C.addEventListener('pointerdown', e => {
  const r = C.getBoundingClientRect();
  tap(e.clientX-r.left, e.clientY-r.top);
}, {passive:true});

phase='menu'; drawMenu();
</script>
</body>
</html>
