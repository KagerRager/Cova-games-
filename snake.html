<!DOCTYPE html>
<html lang="en">
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-P1VFNJ21V0"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-P1VFNJ21V0');</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9556113318001178" crossorigin="anonymous"></script>
<meta charset="UTF-8">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü™®</text></svg>">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Neon Snake ‚Äì GameCave</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Nunito:wght@400;700;800&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;}
html,body{width:100%;height:100%;overflow:hidden;background:#02080a;}
body{display:flex;flex-direction:column;font-family:'Nunito',sans-serif;}
.topbar{flex-shrink:0;background:rgba(2,8,10,0.96);border-bottom:2px solid #0a2a20;padding:0.6rem 1.2rem;display:flex;align-items:center;justify-content:space-between;z-index:10;}
.logo{font-family:'Cinzel',serif;font-size:1.1rem;font-weight:900;color:#e8a020;text-decoration:none;letter-spacing:0.08em;}
.logo span{color:#ffcc55;}
.back{color:#9a8870;text-decoration:none;font-size:0.75rem;font-weight:700;text-transform:uppercase;letter-spacing:0.1em;padding:0.35rem 0.9rem;border:1px solid #0a2a20;border-radius:3px;transition:all .15s;}
.back:hover{color:#3db8a0;border-color:#3db8a0;}
canvas{display:block;flex:1;touch-action:none;}
</style>
</head>
<body>
<!-- LOADING SCREEN -->
<div id="loadingScreen" style="position:fixed;inset:0;z-index:9999;background:#02080a;display:flex;flex-direction:column;align-items:center;justify-content:center;transition:opacity 0.5s ease;">
  <div style="font-family:'Cinzel',serif;font-size:2.5rem;font-weight:900;color:#00ffb4;text-shadow:0 0 20px rgba(0,255,180,0.6);letter-spacing:0.1em;">ü™® GAMECAVE</div>
  <div style="margin-top:1rem;font-family:'Nunito',sans-serif;font-size:1rem;color:#9a8870;letter-spacing:0.15em;text-transform:uppercase;">Loading‚Ä¶</div>
  <div style="margin-top:1.5rem;width:120px;height:4px;background:#0a2a20;border-radius:2px;overflow:hidden;">
    <div id="loadBar" style="height:100%;background:#00ffb4;width:0%;transition:width 0.7s ease;border-radius:2px;"></div>
  </div>
</div>
<script>
  document.getElementById('loadBar').style.width = '100%';
  window.addEventListener('load', () => {
    setTimeout(() => {
      const ls = document.getElementById('loadingScreen');
      ls.style.opacity = '0';
      setTimeout(() => ls.style.display = 'none', 500);
    }, 400);
  });
</script>
<div class="topbar">
  <a class="logo" href="index.html">ü™® GAME<span>CAVE</span></a>
  <a class="back" href="index.html">‚Üê Back</a>
</div>
<div id="colorPicker" style="flex-shrink:0;display:flex;justify-content:center;align-items:center;gap:0.6rem;padding:0.35rem 0;background:rgba(2,8,10,0.9);border-bottom:1px solid #0a2a20;">
  <span style="font-size:0.65rem;color:#9a8870;letter-spacing:0.1em;text-transform:uppercase;margin-right:0.3rem;">Snake:</span>
  <button id="sc0" onclick="snakeColor='#00ffb4';updateSC(0)" style="width:26px;height:26px;border-radius:50%;background:#00ffb4;border:3px solid #fff;cursor:pointer;outline:none;" title="Neon Green"></button>
  <button id="sc1" onclick="snakeColor='#ff4444';updateSC(1)" style="width:26px;height:26px;border-radius:50%;background:#ff4444;border:3px solid transparent;cursor:pointer;outline:none;" title="Red"></button>
  <button id="sc2" onclick="snakeColor='#ff9900';updateSC(2)" style="width:26px;height:26px;border-radius:50%;background:#ff9900;border:3px solid transparent;cursor:pointer;outline:none;" title="Orange"></button>
  <button id="sc3" onclick="snakeColor='#4488ff';updateSC(3)" style="width:26px;height:26px;border-radius:50%;background:#4488ff;border:3px solid transparent;cursor:pointer;outline:none;" title="Blue"></button>
  <button id="sc4" onclick="snakeColor='#cc44ff';updateSC(4)" style="width:26px;height:26px;border-radius:50%;background:#cc44ff;border:3px solid transparent;cursor:pointer;outline:none;" title="Purple"></button>
</div>
<canvas id="c"></canvas>
<script>
'use strict';
// ‚îÄ‚îÄ SOUND ENGINE ‚îÄ‚îÄ
const sfx = (() => {
  let ctx;
  function ensure() { if (!ctx) ctx = new (window.AudioContext||window.webkitAudioContext)(); return ctx; }
  function play(name) {
    try {
      const c = ensure();
      const g = c.createGain();
      g.connect(c.destination);
      const o = c.createOscillator();
      o.connect(g);
      const t = c.currentTime;
      if (name==='start') {
        o.frequency.setValueAtTime(440,t); o.frequency.linearRampToValueAtTime(880,t+0.15);
        g.gain.setValueAtTime(0.25,t); g.gain.linearRampToValueAtTime(0,t+0.2); o.start(t); o.stop(t+0.2);
      } else if (name==='score'||name==='point') {
        o.frequency.setValueAtTime(660,t); o.frequency.linearRampToValueAtTime(880,t+0.08);
        g.gain.setValueAtTime(0.2,t); g.gain.linearRampToValueAtTime(0,t+0.12); o.start(t); o.stop(t+0.12);
      } else if (name==='golden') {
        // golden food fanfare
        [784,1047,1319].forEach((f,i)=>{ const o2=c.createOscillator(); o2.connect(g); o2.type='triangle'; o2.frequency.value=f; o2.start(t+i*0.07); o2.stop(t+i*0.07+0.1); });
        g.gain.setValueAtTime(0.25,t); g.gain.linearRampToValueAtTime(0,t+0.35); o.disconnect();
      } else if (name==='milestone') {
        // milestone every 5 foods
        [523,659,784,659,784].forEach((f,i)=>{ const o2=c.createOscillator(); o2.connect(g); o2.type='square'; o2.frequency.value=f; o2.start(t+i*0.07); o2.stop(t+i*0.07+0.09); });
        g.gain.setValueAtTime(0.15,t); g.gain.linearRampToValueAtTime(0,t+0.5); o.disconnect();
      } else if (name==='speedup') {
        // speed up whoosh
        o.type='sawtooth'; o.frequency.setValueAtTime(150,t); o.frequency.linearRampToValueAtTime(600,t+0.12);
        g.gain.setValueAtTime(0.12,t); g.gain.linearRampToValueAtTime(0,t+0.15); o.start(t); o.stop(t+0.15);
      } else if (name==='die'||name==='over'||name==='hit') {
        o.type='sawtooth'; o.frequency.setValueAtTime(330,t); o.frequency.linearRampToValueAtTime(110,t+0.3);
        g.gain.setValueAtTime(0.3,t); g.gain.linearRampToValueAtTime(0,t+0.35); o.start(t); o.stop(t+0.35);
      } else if (name==='click') {
        o.frequency.setValueAtTime(800,t); g.gain.setValueAtTime(0.1,t); g.gain.linearRampToValueAtTime(0,t+0.05); o.start(t); o.stop(t+0.05);
      }
    } catch(e) {}
  }
  return { play };
})();

// ‚îÄ‚îÄ SNAKE COLOR ‚îÄ‚îÄ
let snakeColor = '#00ffb4';
function updateSC(idx) {
  document.querySelectorAll('#colorPicker button').forEach((b,i) => {
    b.style.border = i === idx ? '3px solid #fff' : '3px solid transparent';
  });
}
const C = document.getElementById('c');
const X = C.getContext('2d');
let W, H;

function resize() {
  W = C.width  = window.innerWidth;
  H = C.height = window.innerHeight - C.getBoundingClientRect().top;
}
resize();
window.addEventListener('resize', () => { resize(); if (phase !== 'play') drawMenu(); });

/* ‚îÄ‚îÄ‚îÄ GRID ‚îÄ‚îÄ‚îÄ */
const CELL = 22;
let cols, rows, ox, oy;

function setupGrid() {
  cols = Math.floor(W * 0.92 / CELL);
  rows = Math.floor((H - 50) * 0.92 / CELL);
  if (cols % 2 === 0) cols--;
  if (rows % 2 === 0) rows--;
  ox = Math.floor((W - cols * CELL) / 2);
  oy = Math.floor(((H - 50) - rows * CELL) / 2) + 50;
}

/* ‚îÄ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ */
let snake, dir, nextDir, food, goldenFood, score, hiScore, speed, phase, frameCount, growCount, foodEaten;

hiScore = 0;

function init() {
  setupGrid();
  const startX = Math.floor(cols / 2);
  const startY = Math.floor(rows / 2);
  snake = [{x: startX, y: startY}, {x: startX - 1, y: startY}, {x: startX - 2, y: startY}];
  dir = {x: 1, y: 0};
  nextDir = {x: 1, y: 0};
  score = 0;
  speed = 8;
  frameCount = 0;
  growCount = 0;
  foodEaten = 0;
  goldenFood = null;
  spawnFood();
  phase = 'play';
  gtag('event', 'game_start', {game: 'Neon Snake'});
}

function spawnFood() {
  let pos;
  do {
    pos = {x: Math.floor(Math.random() * cols), y: Math.floor(Math.random() * rows)};
  } while (snake.some(s => s.x === pos.x && s.y === pos.y));
  food = pos;
  // Every 5 foods, spawn a golden food worth 30 pts
  if (foodEaten > 0 && foodEaten % 5 === 0 && !goldenFood) {
    let gpos;
    do {
      gpos = {x: Math.floor(Math.random() * cols), y: Math.floor(Math.random() * rows)};
    } while (snake.some(s => s.x === gpos.x && s.y === gpos.y) || (gpos.x === food.x && gpos.y === food.y));
    goldenFood = {x: gpos.x, y: gpos.y, timer: 120}; // disappears after 120 frames
  }
}

/* ‚îÄ‚îÄ‚îÄ INPUT ‚îÄ‚îÄ‚îÄ */
document.addEventListener('keydown', e => {
  if (phase === 'menu' || phase === 'over') {
    if ([' ','Enter','ArrowUp','ArrowDown','ArrowLeft','ArrowRight','w','a','s','d'].includes(e.key)) {
      e.preventDefault();
      if (phase === 'over') init(); else startGame();
    }
    return;
  }
  if (phase !== 'play') return;
  switch (e.key) {
    case 'ArrowUp':    case 'w': case 'W': if (dir.y !== 1)  { nextDir = {x: 0, y: -1}; } e.preventDefault(); break;
    case 'ArrowDown':  case 's': case 'S': if (dir.y !== -1) { nextDir = {x: 0, y:  1}; } e.preventDefault(); break;
    case 'ArrowLeft':  case 'a': case 'A': if (dir.x !== 1)  { nextDir = {x: -1, y: 0}; } e.preventDefault(); break;
    case 'ArrowRight': case 'd': case 'D': if (dir.x !== -1) { nextDir = {x:  1, y: 0}; } e.preventDefault(); break;
  }
});

/* Touch swipe */
let tx0 = 0, ty0 = 0;
C.addEventListener('touchstart', e => { tx0 = e.touches[0].clientX; ty0 = e.touches[0].clientY; e.preventDefault(); }, {passive: false});
C.addEventListener('touchend', e => {
  const dx = e.changedTouches[0].clientX - tx0;
  const dy = e.changedTouches[0].clientY - ty0;
  if (phase === 'menu') { startGame(); return; }
  if (phase === 'over') { init(); return; }
  if (Math.abs(dx) > Math.abs(dy)) {
    if (dx > 20 && dir.x !== -1) nextDir = {x: 1, y: 0};
    else if (dx < -20 && dir.x !== 1) nextDir = {x: -1, y: 0};
  } else {
    if (dy > 20 && dir.y !== -1) nextDir = {x: 0, y: 1};
    else if (dy < -20 && dir.y !== 1) nextDir = {x: 0, y: -1};
  }
  e.preventDefault();
}, {passive: false});

function startGame() {
  sfx.play('start');
  init();
}

/* ‚îÄ‚îÄ‚îÄ DRAW HELPERS ‚îÄ‚îÄ‚îÄ */
function gx(col) { return ox + col * CELL; }
function gy(row) { return oy + row * CELL; }

function drawBg() {
  X.fillStyle = '#02080a';
  X.fillRect(0, 0, W, H);
  // grid
  X.strokeStyle = 'rgba(0,255,160,0.04)';
  X.lineWidth = 1;
  for (let c = 0; c <= cols; c++) {
    X.beginPath(); X.moveTo(gx(c), gy(0)); X.lineTo(gx(c), gy(rows)); X.stroke();
  }
  for (let r = 0; r <= rows; r++) {
    X.beginPath(); X.moveTo(gx(0), gy(r)); X.lineTo(gx(cols), gy(r)); X.stroke();
  }
  // border glow
  X.strokeStyle = 'rgba(61,184,160,0.5)';
  X.lineWidth = 2;
  X.strokeRect(ox - 1, oy - 1, cols * CELL + 2, rows * CELL + 2);
}

function drawSnake() {
  snake.forEach((seg, i) => {
    const x = gx(seg.x), y = gy(seg.y);
    const t = 1 - i / snake.length;
    if (i === 0) {
      // head glow
      const g = X.createRadialGradient(x + CELL/2, y + CELL/2, 0, x + CELL/2, y + CELL/2, CELL);
      g.addColorStop(0, 'rgba(0,255,180,0.4)');
      g.addColorStop(1, 'transparent');
      X.fillStyle = g;
      X.fillRect(x - CELL/2, y - CELL/2, CELL * 2, CELL * 2);
      X.fillStyle = snakeColor;
    } else {
      X.fillStyle = `rgba(0,${Math.round(180 + 75 * t)},${Math.round(100 + 80 * t)},${0.5 + 0.5 * t})`;
    }
    const pad = i === 0 ? 2 : 3;
    X.beginPath();
    X.roundRect(x + pad, y + pad, CELL - pad * 2, CELL - pad * 2, i === 0 ? 5 : 3);
    X.fill();
  });
}

function drawFood() {
  const x = gx(food.x) + CELL / 2;
  const y = gy(food.y) + CELL / 2;
  const pulse = 0.8 + 0.2 * Math.sin(frameCount * 0.12);
  // glow
  const g = X.createRadialGradient(x, y, 0, x, y, CELL * pulse);
  g.addColorStop(0, 'rgba(255,80,80,0.6)');
  g.addColorStop(1, 'transparent');
  X.fillStyle = g;
  X.beginPath(); X.arc(x, y, CELL * pulse, 0, Math.PI * 2); X.fill();
  // apple
  X.fillStyle = '#ff4444';
  X.beginPath(); X.arc(x, y, CELL * 0.38 * pulse, 0, Math.PI * 2); X.fill();
  X.fillStyle = '#ff8888';
  X.beginPath(); X.arc(x - 2, y - 2, CELL * 0.12, 0, Math.PI * 2); X.fill();
  // stem
  X.strokeStyle = '#44aa44';
  X.lineWidth = 2;
  X.beginPath(); X.moveTo(x, y - CELL * 0.38 * pulse); X.lineTo(x + 3, y - CELL * 0.5 * pulse); X.stroke();
}

function drawGoldenFood() {
  if (!goldenFood) return;
  const x = gx(goldenFood.x) + CELL / 2;
  const y = gy(goldenFood.y) + CELL / 2;
  const pulse = 0.8 + 0.25 * Math.sin(frameCount * 0.18);
  const fade = Math.min(1, goldenFood.timer / 30); // fades out last 30 frames
  X.globalAlpha = fade;
  // outer glow
  const g = X.createRadialGradient(x, y, 0, x, y, CELL * 1.2 * pulse);
  g.addColorStop(0, 'rgba(255,220,0,0.7)');
  g.addColorStop(1, 'transparent');
  X.fillStyle = g;
  X.beginPath(); X.arc(x, y, CELL * 1.2 * pulse, 0, Math.PI * 2); X.fill();
  // star shape
  X.fillStyle = '#ffdd00';
  X.beginPath();
  for (let i = 0; i < 5; i++) {
    const a1 = (i * 2 * Math.PI / 5) - Math.PI / 2;
    const a2 = a1 + Math.PI / 5;
    const r1 = CELL * 0.4 * pulse, r2 = CELL * 0.17 * pulse;
    if (i === 0) X.moveTo(x + Math.cos(a1) * r1, y + Math.sin(a1) * r1);
    else X.lineTo(x + Math.cos(a1) * r1, y + Math.sin(a1) * r1);
    X.lineTo(x + Math.cos(a2) * r2, y + Math.sin(a2) * r2);
  }
  X.closePath(); X.fill();
  X.strokeStyle = '#fff8aa'; X.lineWidth = 1.5; X.stroke();
  X.globalAlpha = 1;
}

function drawHUD() {
  X.font = 'bold 18px Nunito, sans-serif';
  X.fillStyle = '#3db8a0';
  X.textAlign = 'left';
  X.fillText('SCORE  ' + score, ox, oy - 14);
  X.textAlign = 'right';
  X.fillStyle = '#e8a020';
  X.fillText('BEST  ' + hiScore, ox + cols * CELL, oy - 14);
  // Show golden food hint
  if (goldenFood) {
    X.font = 'bold 13px Nunito, sans-serif';
    X.fillStyle = '#ffdd00';
    X.textAlign = 'center';
    X.fillText('‚≠ê GOLDEN +30', ox + cols * CELL / 2, oy - 14);
  }
}

function drawMenu() {
  setupGrid();
  X.fillStyle = '#02080a';
  X.fillRect(0, 0, W, H);
  drawBg();

  // Title
  X.textAlign = 'center';
  X.font = `bold ${Math.min(72, W * 0.12)}px Cinzel, serif`;
  X.fillStyle = '#00ffb4';
  X.shadowColor = '#00ffb4';
  X.shadowBlur = 30;
  X.fillText('NEON SNAKE', W / 2, H * 0.36);
  X.shadowBlur = 0;

  X.font = `${Math.min(18, W * 0.04)}px Nunito, sans-serif`;
  X.fillStyle = '#9a8870';
  X.fillText('Arrow keys / WASD to move', W / 2, H * 0.47);

  const bw = 220, bh = 52, bx = W / 2 - bw / 2, by = H * 0.56;
  const grad = X.createLinearGradient(bx, by, bx + bw, by);
  grad.addColorStop(0, '#3db8a0'); grad.addColorStop(1, '#1a6a58');
  X.fillStyle = grad;
  X.beginPath(); X.roundRect(bx, by, bw, bh, 6); X.fill();
  X.font = 'bold 18px Nunito, sans-serif';
  X.fillStyle = '#d0f0ea';
  X.fillText('‚ñ∂  PLAY', W / 2, by + 34);

  if (hiScore > 0) {
    X.font = '14px Nunito, sans-serif';
    X.fillStyle = '#e8a020';
    X.fillText('Best: ' + hiScore, W / 2, by + bh + 30);
  }
}

function drawGameOver() {
  // dim overlay
  X.fillStyle = 'rgba(2,8,10,0.75)';
  X.fillRect(0, 0, W, H);

  const bw = Math.min(400, W * 0.85), bh = 280;
  const bx = W / 2 - bw / 2, by = H / 2 - bh / 2;
  X.fillStyle = '#050f0c';
  X.strokeStyle = '#3db8a0';
  X.lineWidth = 2;
  X.beginPath(); X.roundRect(bx, by, bw, bh, 10); X.fill(); X.stroke();

  X.textAlign = 'center';
  X.font = 'bold 42px Cinzel, serif';
  X.fillStyle = '#ff4444';
  X.shadowColor = '#ff4444';
  X.shadowBlur = 20;
  X.fillText('GAME OVER', W / 2, by + 70);
  X.shadowBlur = 0;

  X.font = 'bold 22px Nunito, sans-serif';
  X.fillStyle = '#3db8a0';
  X.fillText('Score: ' + score, W / 2, by + 120);

  if (score >= hiScore && score > 0) {
    X.font = 'bold 16px Nunito, sans-serif';
    X.fillStyle = '#e8a020';
    X.fillText('üèÜ New Best!', W / 2, by + 150);
  }

  const rbw = 200, rbh = 48, rbx = W / 2 - rbw / 2, rby = by + 185;
  const rg = X.createLinearGradient(rbx, rby, rbx + rbw, rby);
  rg.addColorStop(0, '#3db8a0'); rg.addColorStop(1, '#1a6a58');
  X.fillStyle = rg;
  X.beginPath(); X.roundRect(rbx, rby, rbw, rbh, 6); X.fill();
  X.font = 'bold 17px Nunito, sans-serif';
  X.fillStyle = '#d0f0ea';
  X.fillText('‚ñ∂  PLAY AGAIN', W / 2, rby + 31);
}

/* ‚îÄ‚îÄ‚îÄ GAME LOOP ‚îÄ‚îÄ‚îÄ */
function update() {
  const interval = Math.max(3, Math.round(60 / speed));
  if (frameCount % interval !== 0) return;

  dir = {...nextDir};
  const head = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};

  // Wall collision
  if (head.x < 0 || head.x >= cols || head.y < 0 || head.y >= rows) {
    gameOver(); return;
  }
  // Self collision
  if (snake.some(s => s.x === head.x && s.y === head.y)) {
    gameOver(); return;
  }

  snake.unshift(head);

  // Tick down golden food timer
  if (goldenFood) {
    goldenFood.timer--;
    if (goldenFood.timer <= 0) goldenFood = null;
  }

  if (head.x === food.x && head.y === food.y) {
    score += 10;
    foodEaten++;
    if (score > hiScore) hiScore = score;
    growCount += 2;
    const prevSpeed = speed;
    speed = Math.min(20, 8 + Math.floor(score / 50));
    if (speed > prevSpeed) sfx.play('speedup');
    else sfx.play('score');
    // Milestone every 5 foods
    if (foodEaten % 5 === 0) setTimeout(() => sfx.play('milestone'), 150);
    spawnFood();
    gtag('event', 'food_eaten', {game: 'Neon Snake', score});
  } else if (goldenFood && head.x === goldenFood.x && head.y === goldenFood.y) {
    score += 30;
    if (score > hiScore) hiScore = score;
    growCount += 4;
    sfx.play('golden');
    goldenFood = null;
    gtag('event', 'golden_food_eaten', {game: 'Neon Snake', score});
  } else if (growCount > 0) {
    growCount--;
  } else {
    snake.pop();
  }
}

function gameOver() {
  if (score > hiScore) hiScore = score;
  sfx.play('die');
  gtag('event', 'game_over', {game: 'Neon Snake', score, length: snake.length});
  phase = 'over';
}

let animId;
function loop() {
  animId = requestAnimationFrame(loop);
  frameCount++;

  if (phase === 'play') {
    update();
    drawBg();
    drawFood();
    drawGoldenFood();
    drawSnake();
    drawHUD();
  } else if (phase === 'over') {
    drawBg();
    drawFood();
    drawGoldenFood();
    drawSnake();
    drawHUD();
    drawGameOver();
  }
}

phase = 'menu';
drawMenu();
loop();

// Clicking the canvas starts the game
C.addEventListener('click', () => {
  sfx.play('click');
  if (phase === 'menu') startGame();
  else if (phase === 'over') init();
});
</script>
</body>
</html>
